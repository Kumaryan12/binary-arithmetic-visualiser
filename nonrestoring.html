<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Non-Restoring Division Visualizer</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    body {
      background: radial-gradient(circle at 20% 20%, #0f172a, #1e293b);
      color: #f8fafc;
      font-family: 'Poppins', sans-serif;
    }

    .division-container {
      background: rgba(30, 41, 59, 0.9);
      padding: 25px;
      border-radius: 16px;
      width: 85%;
      max-width: 1100px;
      margin: 30px auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }

    h2 {
      color: #38bdf8;
      text-align: center;
      font-size: 1.8em;
      margin-bottom: 15px;
    }

    .inputs {
      text-align: center;
      margin: 20px 0;
    }

    input {
      width: 120px;
      padding: 8px;
      text-align: center;
      border: none;
      border-radius: 8px;
      background: #f1f5f9;
      color: #000;
      margin-right: 10px;
      font-weight: 600;
    }

    button {
      background: linear-gradient(90deg, #38bdf8, #0ea5e9);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: #0f172a;
      font-weight: 600;
      cursor: pointer;
      margin: 6px;
      box-shadow: 0 0 10px rgba(56,189,248,0.4);
      transition: 0.3s;
    }

    button:hover {
      background: #0ea5e9;
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(56,189,248,0.6);
    }

    .registers {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .register {
      background: #1e293b;
      padding: 10px 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 12px rgba(56,189,248,0.3);
      min-width: 150px;
    }

    .register h4 {
      color: #38bdf8;
    }

    .bits {
      display: flex;
      gap: 4px;
      justify-content: center;
      margin-top: 6px;
    }

    .bit {
      width: 26px;
      height: 26px;
      background: #334155;
      color: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.9em;
    }

    .explanation {
      background: rgba(148,163,184,0.15);
      padding: 14px;
      border-radius: 10px;
      margin-top: 25px;
      font-size: 1.05em;
    }

    .step-log {
      margin-top: 25px;
      background: rgba(15,23,42,0.6);
      border: 1px solid rgba(56,189,248,0.2);
      border-radius: 10px;
      padding: 15px;
      height: 220px;
      overflow-y: auto;
      box-shadow: inset 0 0 10px rgba(56,189,248,0.1);
    }

    .log-entry {
      margin-bottom: 8px;
      border-left: 3px solid #38bdf8;
      padding-left: 8px;
      font-size: 0.95em;
      line-height: 1.4;
    }

    .log-entry b {
      color: #38bdf8;
    }

    .output {
      margin-top: 25px;
      font-weight: 600;
      text-align: center;
      font-size: 1.15em;
      color: #f8fafc;
    }

    .footer-buttons {
      text-align: center;
      margin-top: 25px;
    }

    a.back {
      display: block;
      text-align: center;
      text-decoration: none;
      color: #38bdf8;
      font-weight: 600;
      margin-top: 20px;
    }

    a.back:hover {
      color: #0ea5e9;
    }

    summary {
      color: #38bdf8;
      font-size: 1.1em;
      margin-top: 25px;
      cursor: pointer;
    }

    details {
      background: rgba(148,163,184,0.1);
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
      color: #e2e8f0;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="division-container">
    <h2>Non-Restoring Division Algorithm ‚Äì Step-by-Step Visualizer</h2>

    <div class="inputs">
      <input type="number" id="dividend" placeholder="Dividend (Q)">
      <input type="number" id="divisor" placeholder="Divisor (M)">
      <button onclick="startNonRestoring()">Start</button>
    </div>

    <div class="registers">
      <div class="register">
        <h4>AC</h4>
        <div id="ac-bits" class="bits"></div>
      </div>
      <div class="register">
        <h4>Q</h4>
        <div id="q-bits" class="bits"></div>
      </div>
      <div class="register">
        <h4>M</h4>
        <div id="m-bits" class="bits"></div>
      </div>
    </div>

    <details>
      <summary>üìò Theory: Non-Restoring Division Algorithm</summary>
      <p>
        The Non-Restoring Division Algorithm avoids restoration of the partial remainder in each cycle, improving efficiency.  
      </p>
      <ol>
        <li>Shift left (AC, Q).</li>
        <li>If AC ‚â• 0 ‚Üí AC = AC - M; else ‚Üí AC = AC + M.</li>
        <li>If AC ‚â• 0 ‚Üí Q‚ÇÄ = 1; else ‚Üí Q‚ÇÄ = 0.</li>
        <li>Repeat for all bits.</li>
        <li>If AC < 0 ‚Üí perform final correction: AC = AC + M.</li>
      </ol>
      <p><b>Result:</b> Quotient = Q, Remainder = AC</p>
    </details>

    <div class="explanation" id="explanation">Enter values and click <b>Start</b> to begin.</div>

    <!-- Step Log Panel -->
    <div class="step-log" id="step-log">
      <p><i>Step log will appear here...</i></p>
    </div>

    <div class="footer-buttons">
      <button id="next-btn" onclick="nextStep()" disabled>Next Step ‚ñ∂Ô∏è</button>
      <button id="reset-btn" onclick="resetSimulation()" disabled>Reset üîÑ</button>
    </div>

    <div class="output" id="result"></div>
    <a class="back" href="index.html">üè† Back to Home</a>
  </div>

  <script>
    let steps = [];
    let currentStep = 0;
    let n, M, Q, AC;

    function toBinary(num, bits) {
      if (num < 0) num = (1 << bits) + num;
      return num.toString(2).padStart(bits, '0');
    }

    function startNonRestoring() {
      const dividend = parseInt(document.getElementById('dividend').value);
      const divisor  = parseInt(document.getElementById('divisor').value);
      if (isNaN(dividend) || isNaN(divisor) || divisor === 0) {
        alert("Please enter valid numbers (divisor ‚â† 0).");
        return;
      }

      n = 5;
      Q = toBinary(dividend, n);
      M = toBinary(divisor, n);
      AC = '0'.repeat(n);

      steps = [];
      let tempAC = AC, tempQ = Q, count = n;

      while (count > 0) {
        // Shift left (AC,Q)
        let combined = (tempAC + tempQ).slice(1) + '0';
        tempAC = combined.slice(0, n);
        tempQ  = combined.slice(n, 2 * n);

        let tempACdec = parseInt(tempAC, 2);
        if (tempACdec >= (1 << (n - 1))) tempACdec -= (1 << n);

        let operation, explain;
        if (tempACdec >= 0) {
          tempACdec -= parseInt(M, 2);
          operation = "AC = AC - M";
          explain = "AC ‚â• 0 ‚Üí Subtract M.";
        } else {
          tempACdec += parseInt(M, 2);
          operation = "AC = AC + M";
          explain = "AC < 0 ‚Üí Add M.";
        }

        let q0;
        if (tempACdec >= 0) { q0 = '1'; explain += " Set Q‚ÇÄ = 1."; }
        else { q0 = '0'; explain += " Set Q‚ÇÄ = 0."; }

        tempQ = tempQ.slice(0, -1) + q0;
        tempAC = (tempACdec & ((1 << n) - 1)).toString(2).padStart(n, '0');

        steps.push({
          step: n - count + 1,
          AC: tempAC,
          Q: tempQ,
          operation,
          explain
        });
        count--;
      }

      let finalACdec = parseInt(steps[steps.length - 1].AC, 2);
      if (finalACdec >= (1 << (n - 1))) finalACdec -= (1 << n);
      if (finalACdec < 0) {
        finalACdec += parseInt(M, 2);
        let corrected = (finalACdec & ((1 << n) - 1)).toString(2).padStart(n, '0');
        steps.push({
          step: 'Final Correction',
          AC: corrected,
          Q: steps[steps.length - 1].Q,
          operation: "AC = AC + M (Correction)",
          explain: "Final correction: AC < 0 ‚Üí Add M to AC."
        });
      }

      currentStep = 0;
      document.getElementById('next-btn').disabled = false;
      document.getElementById('reset-btn').disabled = false;
      updateRegisters(AC, Q, M);
      document.getElementById('explanation').innerHTML = 'Ready! Click <b>Next Step ‚ñ∂Ô∏è</b> to proceed.';
      document.getElementById('step-log').innerHTML = '<i>Simulation initialized...</i>';
    }

    function nextStep() {
      if (currentStep >= steps.length) {
        const final = steps[steps.length - 1];
        const quotient  = parseInt(final.Q, 2);
        const remainder = parseInt(final.AC, 2);
        document.getElementById('result').innerHTML =
          `<strong>Quotient:</strong> ${quotient} (Binary: ${final.Q})<br>
           <strong>Remainder:</strong> ${remainder} (Binary: ${final.AC})`;
        document.getElementById('next-btn').disabled = true;
        addLog(`‚úÖ Final Result ‚Üí Quotient=${quotient}, Remainder=${remainder}`);
        return;
      }

      let s = steps[currentStep];
      updateRegisters(s.AC, s.Q, M);
      document.getElementById('explanation').innerHTML =
        `<b>Step ${s.step}:</b> ${s.explain}<br><i>${s.operation}</i>`;
      addLog(`Step ${s.step}: AC=${s.AC}, Q=${s.Q} ‚Üí ${s.operation}`);
      currentStep++;
    }

    function resetSimulation() {
      steps = [];
      currentStep = 0;
      document.getElementById('explanation').innerHTML = 'Enter values and click <b>Start</b> to begin.';
      document.getElementById('ac-bits').innerHTML = '';
      document.getElementById('q-bits').innerHTML  = '';
      document.getElementById('m-bits').innerHTML  = '';
      document.getElementById('result').innerHTML  = '';
      document.getElementById('step-log').innerHTML = '<i>Step log cleared.</i>';
      document.getElementById('next-btn').disabled = true;
      document.getElementById('reset-btn').disabled = true;
    }

    function updateRegisters(ac, q, m) {
      renderBits('ac-bits', ac);
      renderBits('q-bits', q);
      renderBits('m-bits', m);
    }

    function renderBits(id, bits) {
      const container = document.getElementById(id);
      container.innerHTML = '';
      bits.split('').forEach(b => {
        const div = document.createElement('div');
        div.classList.add('bit');
        div.textContent = b;
        container.appendChild(div);
      });
    }

    function addLog(text) {
      const log = document.getElementById('step-log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = text;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }
  </script>
</body>
</html>
